<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% extends 'adminlte/base.html' %}
{% block title %}Investment Dashboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mt-3 mb-3">All Investments</h1>
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>Ticker</th>
                                <th>Quantity</th>
                                <th>Purchase Date</th>
                                <th>Purchase Price ($)</th>
                                <th>Investment Value at Purchase ($)</th>
                                <th>Current Price ($)</th>
                                <th>Current Value ($)</th>
                                <th>1 Day Change ($)</th>
                                <th>1 Day Change (%)</th>
                                <th>3 Months Change ($)</th>
                                <th>3 Months Change (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ticker, data in investment_data.items %}
                            <tr>
                                <td>{{ ticker }}</td>
                                <td>{{ data.0|floatformat:2 }}</td>
                                <td>{{ data.1 }}</td>
                                <td>{{ data.2|floatformat:2 }}</td>
                                <td>{{ data.3|floatformat:2 }}</td>
                                <td>{{ data.4|floatformat:2 }}</td>
                                <td>{{ data.5|floatformat:2 }}</td>
                                <td style="color: {% if data.6 > 0 %}green{% else %}red{% endif %}">{{ data.6|floatformat:2 }}</td>
                                <td style="color: {% if data.7 > 0 %}green{% else %}red{% endif %}">{{ data.7|floatformat:2 }}</td>
                                <td style="color: {% if data.8 > 0 %}green{% else %}red{% endif %}">{{ data.8|floatformat:2 }}</td>
                                <td style="color: {% if data.9 > 0 %}green{% else %}red{% endif %}">{{ data.9|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Investment Value Line Chart</h3>
            </div>
            <div class="card-body">
                <div style="position: relative; height: 400px; width: 100%;">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Current Investment Value Distribution</h3>
            </div>
            <div class="card-body">
                <div style="position: relative; height: 400px; width: 100%;">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var pieChartData = {{ pie_chart_data | safe }};
    var plotData = {{ plot_data | safe }};

    // Render the pie chart
    var pieCtx = document.getElementById('pieChart').getContext('2d');
    var pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: pieChartData.labels,
            datasets: [{
                label: 'Investment Distribution',
                data: pieChartData.sizes,
                backgroundColor: getRandomColors(pieChartData.labels.length),
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false // Ensure chart respects container dimensions
        }
    });

    // Render the line chart
    var lineChartData = {
        labels: plotData.dates,
        datasets: [{
            label: 'Investment Value',
            data: plotData.close_prices,
            fill: false,
            borderColor: 'blue',
            tension: 0.1
        }]
    };

    var lineCtx = document.getElementById('lineChart').getContext('2d');
    var lineChart = new Chart(lineCtx, {
        type: 'line',
        data: lineChartData,
        options: {
            responsive: true,
            maintainAspectRatio: false // Ensure chart respects container dimensions
        }
    });

    function getRandomColors(numColors) {
        var colors = [];
        for (var i = 0; i < numColors; i++) {
            var color = '#' + Math.floor(Math.random() * 16777215).toString(16);
            colors.push(color);
        }
        return colors;
    }
});
</script>

{% endblock %}
